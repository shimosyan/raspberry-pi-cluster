# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/tfaction/refs/tags/v1.15.5/schema/tfaction-root.json

plan_workflow_name: Pull Request

tflint:
  enabled: true
  fix: true
trivy:
  enabled: true

drift_detection:
  enabled: true

target_groups:
  - working_directory: proxmox
    target: proxmox
    aws_region: ap-northeast-1
    secrets:
      - env_name: TF_VAR_root_pw
        secret_name: DEFAULT_ROOT_PW
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_raspberry-pi-cluster_terraform_plan
      env:
        TF_VAR_pm_minimum_permission_check: "false" # Terraform Provider の telmate/proxmox が実施している最低限の権限チェックを無効化する
      secrets:
        - env_name: PM_API_TOKEN_ID
          secret_name: PM_READONLY_API_TOKEN_ID
        - env_name: PM_API_TOKEN_SECRET
          secret_name: PM_READONLY_API_TOKEN_SECRET
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_raspberry-pi-cluster_terraform_apply
      secrets:
        - env_name: PM_API_TOKEN_ID
          secret_name: PM_WRITABLE_API_TOKEN_ID
        - env_name: PM_API_TOKEN_SECRET
          secret_name: PM_WRITABLE_API_TOKEN_SECRET
