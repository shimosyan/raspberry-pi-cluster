# Virtual Machine Setup

## OS イメージの追加

### OS イメージのダウンロード

Ubuntu の公式サイトから [arm64 向けのインストールイメージ](https://ubuntu.com/download/server/arm)をダウンロードします。amd64は使用できないので注意してください。

## OS イメージの登録

イメージが入手できたら、Proxmox から各ノードの local ストレージを開きます。

ストレージメニューに ISO があるので、ここからアップロードします。

この手順をすべてのノードに対して実施します。

## Virtual Machine の準備

### 新規 Virtual Machine の作成

ダッシュボード右上の「VMを作成」をクリックします。

作成ウィンドウが立ち上がるので、以下の通りに入力します。指定ないものはデフォルト値のままにします。

太字の箇所は指示通りに入力しないと起動しません。

|カテゴリ|項目|値|
|---|---|---|
|全般|ノード|VM を設置したいノード|
|全般|名前|任意の名前を入力|
|OS|CD/DVD イメージファイル (iso) を使用する|ON|
|OS|ストレージ|local|
|OS|ISO イメージ|上記手順で登録した ubuntu の ISO イメージ|
|システム|BIOS|**OVMF (UEFI)**|
|システム|EFI Storage|**NAS を選択**|
|システム|ディスクイメージ|**NAS 上に作成した LUN を選択**|
|ディスク|ストレージ|**NAS を選択**|
|ディスク|ディスクイメージ|**NAS 上に作成した LUN を選択**|
|CPU|ソケット|お好みで|
|CPU|コア|お好みで|
|メモリ|容量|お好みで|

### Virtual Machine の修正

このままでは起動しません。いくつか変更が必要です。

VM の概要ページを開いて、既存の `CD/DVD Drive(ide*)` を削除します。

次に、追加メニューから CD/DVD ドライブをクリックします。

設定ウィンドウが表示されるので、次のように入力してOKをクリックします。

|項目|値|
|---|---|
|バス/デバイス|SCSI 1|
|ストレージ|local|
|ISO イメージ|上記手順で登録した ubuntu の ISO イメージ|

## Virtual Machine の起動

VM の概要ページ右上から「開始」を実行します。

無事起動ができたら、VM の概要ページ右上から「コンソール」をクリックすると VM の画面を表示できます。

初回起動の際は `BdsDxe: failed to load Boot****` と表示されますが、しばらく放っておいて問題ありません。

しばらくすると、Ubuntu のインストーラーがブートされるので、`Try or Install Ubuntu` を選びます。

表示できる画面がないメッセージになりますが、しばらく放っておいて問題ありません。

### Ubuntu のセットアップ

またしばらくすると、Ubuntu のセットアップ画面になります。次のように進めます。

- 言語設定：日本語はプリインストールされていないため `English` を選択します。
- キーボード設定：ここでは `Japanese` を選択します。
- インストールタイプ：ここでは `Ubuntu Server` を選択します。
- ネットワーク設定：IPアドレスを指定します。
  - Subnet: `192.168.6.0/24`
  - Address: サーバーに割り振りたい固定IP
  - Gateway: `192.168.6.1`
  - Name servers: `192.168.2.1`
- プロキシサーバー：なにもせず次に進みます。
- アーカイブミラーサーバー：デフォルトのまま次に進みます。
- ストレージ設定：TBD

## 参考資料

- <https://qiita.com/wancom/items/b62ac44e6c9f0d1c4048#vm%E3%82%92%E4%BD%9C%E6%88%90%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B>
- <https://zenn.dev/hatotk/articles/install-ubuntu-server-20-04-lts>
